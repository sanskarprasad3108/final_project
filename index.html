<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dump Truck Anomaly Detection</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #0f0f23 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr 320px;
            grid-template-rows: auto 1fr;
            gap: 15px;
            padding: 15px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(20, 20, 40, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .title h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }

        .title-icon {
            font-size: 2rem;
        }

        /* Status Section */
        .status-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .system-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 25px;
            border-radius: 10px;
            min-width: 200px;
        }

        .status-label {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.3rem;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .status-normal {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 200, 100, 0.1));
            border: 2px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .status-normal .status-value {
            color: #00ff88;
        }

        .status-anomaly {
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.3), rgba(200, 50, 50, 0.1));
            border: 2px solid #ff4444;
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
            animation: pulse-red 0.5s ease-in-out infinite;
        }

        .status-anomaly .status-value {
            color: #ff4444;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 68, 68, 0.8); }
        }

        /* Metrics Display */
        .metrics {
            display: flex;
            gap: 15px;
        }

        .metric-box {
            background: rgba(30, 30, 50, 0.8);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            text-align: center;
        }

        .metric-label {
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #00ff88;
            font-family: 'Courier New', monospace;
        }

        /* Left Panel */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Control Panel */
        .control-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .panel-title {
            font-size: 1rem;
            color: #00d4ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            padding-bottom: 10px;
        }

        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-normal {
            background: linear-gradient(135deg, #00aa55, #00ff88);
            color: #000;
        }

        .btn-normal:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4444, #ff6b6b);
            color: #fff;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffaa00, #ffcc00);
            color: #000;
            animation: pulse-yellow 1s ease-in-out infinite;
        }

        @keyframes pulse-yellow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 170, 0, 0.5); }
            50% { box-shadow: 0 0 25px rgba(255, 170, 0, 0.8); }
        }

        .btn-toggle {
            position: relative;
            overflow: hidden;
        }

        /* Toggle Status Indicators */
        .toggle-status {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.active {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .status-dot.inactive {
            background: #555;
        }

        .status-dot.danger {
            background: #ff4444;
            box-shadow: 0 0 10px #ff4444;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* 3D Plot Panel */
        .plot-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            flex: 1;
        }

        #pca-plot {
            width: 100%;
            height: 280px;
            border-radius: 8px;
        }

        /* Center Panel */
        .center-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Charts */
        .chart-container {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            flex: 1;
        }

        .chart-title {
            font-size: 0.9rem;
            color: #00d4ff;
            margin-bottom: 10px;
        }

        #chart-engine, #chart-vibration {
            width: 100%;
            height: 200px;
        }

        /* ========================================
           TRUCK VISUALIZATION - FLAT VECTOR STYLE
           Industrial monitoring dashboard design
           ======================================== */
        
        .truck-panel {
            background: linear-gradient(180deg, rgba(15, 20, 35, 0.95) 0%, rgba(20, 25, 45, 0.95) 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(0, 255, 136, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .truck-diagram {
            position: relative;
            width: 100%;
            height: 320px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .truck-svg {
            width: 100%;
            height: 100%;
            max-width: 540px;
        }

        /* ========================================
           SVG COMPONENT GLOW STATES - CSS APPROACH
           Applied via JavaScript class toggling
           ======================================== */
        
        /* Anomaly state - RED glow with pulse animation */
        .svg-anomaly {
            filter: drop-shadow(0 0 8px #ff0000) 
                    drop-shadow(0 0 15px #ff3333) 
                    drop-shadow(0 0 25px #ff5555) !important;
            animation: svg-red-pulse 0.5s ease-in-out infinite !important;
        }
        
        /* Force anomaly on specific elements by ID */
        #truck-engine.svg-anomaly,
        #truck-hydraulics.svg-anomaly,
        #truck-chassis.svg-anomaly,
        #truck-wheels.svg-anomaly {
            filter: drop-shadow(0 0 10px #ff0000) 
                    drop-shadow(0 0 20px #ff2222) 
                    drop-shadow(0 0 35px #ff4444) !important;
        }
        
        @keyframes svg-red-pulse {
            0%, 100% {
                filter: drop-shadow(0 0 8px #ff0000) 
                        drop-shadow(0 0 15px #ff3333) 
                        drop-shadow(0 0 25px #ff5555);
            }
            50% {
                filter: drop-shadow(0 0 15px #ff0000) 
                        drop-shadow(0 0 30px #ff2222) 
                        drop-shadow(0 0 50px #ff4444);
            }
        }
        
        /* Normal state - GREEN glow */
        .svg-normal {
            filter: drop-shadow(0 0 5px #00ff88) !important;
        }
        
        #truck-engine.svg-normal,
        #truck-hydraulics.svg-normal,
        #truck-chassis.svg-normal,
        #truck-wheels.svg-normal {
            filter: drop-shadow(0 0 4px #00ff88) drop-shadow(0 0 8px rgba(0,255,136,0.5)) !important;
        }

        /* ========================================
           SMOKE ANIMATION SYSTEM
           Realistic grey smoke that rises from 
           components with detected anomalies
           ======================================== */
        
        /* Base smoke group - hidden by default */
        .smoke-group {
            display: none;
            opacity: 0;
        }
        
        /* Active smoke - visible with animation */
        .smoke-active {
            display: block !important;
            opacity: 1;
        }
        
        /* Individual smoke puff animation */
        .smoke-puff {
            fill: #8b8b8b;
            opacity: 0;
            animation: smokeRise 2.5s ease-out infinite;
        }
        
        .smoke-puff-1 { animation-delay: 0s; }
        .smoke-puff-2 { animation-delay: 0.4s; }
        .smoke-puff-3 { animation-delay: 0.8s; }
        .smoke-puff-4 { animation-delay: 1.2s; }
        .smoke-puff-5 { animation-delay: 1.6s; }
        
        @keyframes smokeRise {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0.5);
            }
            15% {
                opacity: 0.5;
            }
            50% {
                opacity: 0.4;
                transform: translateY(-25px) scale(1);
            }
            80% {
                opacity: 0.15;
                transform: translateY(-45px) scale(1.3);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1.5);
            }
        }
        
        /* Wispy smoke effect - more random movement */
        .smoke-wisp {
            fill: #9ca3af;
            opacity: 0;
            animation: smokeWisp 3s ease-out infinite;
        }
        
        .smoke-wisp-1 { animation-delay: 0.2s; }
        .smoke-wisp-2 { animation-delay: 0.7s; }
        .smoke-wisp-3 { animation-delay: 1.1s; }
        
        @keyframes smokeWisp {
            0% {
                opacity: 0;
                transform: translateY(0) translateX(0) scale(0.4);
            }
            20% {
                opacity: 0.35;
                transform: translateY(-10px) translateX(3px) scale(0.7);
            }
            50% {
                opacity: 0.3;
                transform: translateY(-30px) translateX(-5px) scale(1);
            }
            75% {
                opacity: 0.15;
                transform: translateY(-50px) translateX(8px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-70px) translateX(-3px) scale(1.4);
            }
        }
        
        /* Dark smoke for severe anomalies */
        .smoke-dark {
            fill: #6b7280;
            opacity: 0;
            animation: smokeDark 2s ease-out infinite;
        }
        
        .smoke-dark-1 { animation-delay: 0.3s; }
        .smoke-dark-2 { animation-delay: 0.9s; }
        
        @keyframes smokeDark {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0.6);
            }
            25% {
                opacity: 0.45;
            }
            60% {
                opacity: 0.35;
                transform: translateY(-20px) scale(0.9);
            }
            100% {
                opacity: 0;
                transform: translateY(-40px) scale(1.2);
            }
        }

        /* ========================================
           COMPONENT LABELS - Floating pill badges
           ======================================== */
        
        .component-label {
            position: absolute;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.68rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(8px);
            text-transform: uppercase;
            z-index: 10;
        }

        .component-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        /* Normal/Healthy state styling - GREEN */
        .component-normal {
            background: rgba(0, 255, 136, 0.15);
            border: 1.5px solid rgba(0, 255, 136, 0.6);
            color: #00ff88;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
        }

        .component-normal .component-dot {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88, 0 0 20px rgba(0, 255, 136, 0.5);
        }

        /* Fault/Anomaly state styling - RED with pulse */
        .component-fault {
            background: rgba(255, 68, 68, 0.25);
            border: 2px solid rgba(255, 68, 68, 0.9);
            color: #ff6b6b;
            box-shadow: 0 4px 25px rgba(255, 68, 68, 0.5);
            animation: label-pulse-fault 0.5s ease-in-out infinite;
        }

        .component-fault .component-dot {
            background: #ff4444;
            box-shadow: 0 0 15px #ff4444, 0 0 30px rgba(255, 68, 68, 0.8);
            animation: dot-blink 0.3s ease-in-out infinite;
        }
        
        @keyframes label-pulse-fault {
            0%, 100% { 
                box-shadow: 0 4px 20px rgba(255, 68, 68, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 4px 35px rgba(255, 68, 68, 0.7);
                transform: scale(1.03);
            }
        }
        
        @keyframes dot-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Label positioning - optimized for new SVG layout */
        #engine-label { 
            top: 25px; 
            left: 5%; 
        }
        #hydraulic-label { 
            top: 25px; 
            right: 12%; 
        }
        #chassis-label { 
            bottom: 45px; 
            left: 50%;
            transform: translateX(-50%);
        }
        #wheels-label { 
            bottom: 10px; 
            right: 15%; 
        }
        
        /* Responsive label positioning */
        @media (max-width: 600px) {
            #engine-label { left: 2%; top: 20px; }
            #hydraulic-label { right: 2%; top: 20px; }
            #chassis-label { bottom: 40px; }
            #wheels-label { right: 8%; bottom: 5px; }
        }

        /* ========================================
           COMPONENT NAVIGATION SECTION
           Quick access to dedicated component interfaces
           ======================================== */
        
        .component-nav-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            margin-top: 15px;
        }
        
        .component-nav-title {
            font-size: 1rem;
            color: #ffd700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }
        
        .component-nav-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .component-nav-btn {
            padding: 14px 16px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 170, 0, 0.05));
            color: #ffd700;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
            transition: all 0.15s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        
        .component-nav-btn:hover {
            transform: translateY(-2px);
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 170, 0, 0.15));
            box-shadow: 0 5px 25px rgba(255, 215, 0, 0.35);
        }
        
        .component-nav-btn:active {
            transform: translateY(0);
        }
        
        .component-nav-icon {
            font-size: 1.5rem;
        }
        
        .component-nav-label {
            font-size: 0.75rem;
        }
        
        .component-nav-status {
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .component-nav-status.anomaly {
            background: rgba(255, 68, 68, 0.3);
            color: #ff4444;
            animation: status-pulse 0.5s ease-in-out infinite;
        }
        
        @keyframes status-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Right Panel - Sensor Readings */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sensor-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            flex: 1;
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .sensor-card {
            background: rgba(10, 10, 30, 0.8);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(0, 255, 136, 0.15);
            transition: all 0.3s ease;
        }

        .sensor-card.anomaly {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }

        .sensor-name {
            font-size: 0.65rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .sensor-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #00ff88;
            font-family: 'Courier New', monospace;
        }

        .sensor-card.anomaly .sensor-value {
            color: #ff4444;
        }

        /* Simulation Controls */
        .sim-controls {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .sim-buttons {
            display: flex;
            gap: 10px;
        }

        .sim-buttons .btn {
            flex: 1;
        }

        /* ========================================
           FAILURE PROBABILITY PANEL
           Shows weighted failure rates per component
           ======================================== */
        .probability-panel {
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 170, 0, 0.3);
        }

        .probability-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .probability-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 10px 12px;
            background: rgba(10, 10, 30, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .probability-item.failing {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.15);
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }

        .probability-item.failing .prob-component {
            color: #ff6b6b;
        }

        .probability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prob-component {
            font-size: 0.75rem;
            font-weight: 700;
            color: #00d4ff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .prob-percentage {
            font-size: 0.9rem;
            font-weight: bold;
            color: #ffaa00;
            font-family: 'Courier New', monospace;
        }

        .probability-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 4px;
            overflow: hidden;
        }

        .probability-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease, background 0.3s ease;
        }

        .probability-bar.engine {
            background: linear-gradient(90deg, #ff6b6b, #ff4444);
        }

        .probability-bar.hydraulic {
            background: linear-gradient(90deg, #ffd93d, #ffaa00);
        }

        .probability-bar.wheels {
            background: linear-gradient(90deg, #6bcb77, #4CAF50);
        }

        .probability-bar.chassis {
            background: linear-gradient(90deg, #4fc3f7, #00d4ff);
        }

        .prob-status {
            font-size: 0.6rem;
            color: #666;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .prob-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00ff88;
        }

        .prob-status-dot.failing {
            background: #ff4444;
            animation: prob-dot-pulse 0.5s ease-in-out infinite;
        }

        @keyframes prob-dot-pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 4px #ff4444; }
            50% { opacity: 0.5; box-shadow: 0 0 8px #ff4444; }
        }

        .probability-legend {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.6rem;
            color: #666;
            text-align: center;
            line-height: 1.4;
        }

        /* Footer */
        .footer {
            grid-column: 1 / -1;
            text-align: center;
            padding: 10px;
            color: #555;
            font-size: 0.8rem;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: 280px 1fr 280px;
            }
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="title">
                <span class="title-icon">üöõ</span>
                <h1>Dump Truck Anomaly Detection</h1>
            </div>
            
            <div class="status-section">
                <div class="metrics">
                    <div class="metric-box">
                        <div class="metric-label">Reconstruction Loss</div>
                        <div class="metric-value" id="recon-error">0.000</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Threshold</div>
                        <div class="metric-value" id="threshold-value">0.000</div>
                    </div>
                </div>
                
                <div class="system-status status-normal" id="system-status">
                    <div class="status-label">System Status</div>
                    <div class="status-value" id="status-text">SYSTEM NORMAL</div>
                </div>
            </div>
        </div>

        <!-- Left Panel -->
        <div class="left-panel">
            <div class="control-panel">
                <div class="panel-title">
                    <span>‚öôÔ∏è</span> Simulation Controls
                </div>
                <div class="control-buttons">
                    <button class="btn btn-normal" id="btn-simulate" onclick="toggleSimulation()">
                        üìä Simulate Normal
                    </button>
                    <button class="btn btn-danger" id="btn-inject" onclick="toggleInjection()">
                        üî• INJECT FAILURE üî•
                    </button>
                </div>
                <div class="toggle-status">
                    <div class="status-item">
                        <span class="status-dot" id="dot-injection"></span>
                        <span id="label-injection">Inject Failure: OFF</span>
                    </div>
                    <div class="status-item">
                        <span class="status-dot" id="dot-auto"></span>
                        <span id="label-auto">Auto Mode: OFF</span>
                    </div>
                </div>
            </div>

            <!-- Component Navigation Section -->
            <div class="component-nav-panel">
                <div class="component-nav-title">
                    <span>üöõ</span> Dump Truck Components
                </div>
                <div class="component-nav-grid">
                    <a href="/component/engine" class="component-nav-btn">
                        <span class="component-nav-icon">üîß</span>
                        <span class="component-nav-label">ENGINE</span>
                        <span class="component-nav-status" id="nav-status-engine">NORMAL</span>
                    </a>
                    <a href="/component/hydraulic" class="component-nav-btn">
                        <span class="component-nav-icon">‚öôÔ∏è</span>
                        <span class="component-nav-label">HYDRAULICS</span>
                        <span class="component-nav-status" id="nav-status-hydraulic">NORMAL</span>
                    </a>
                    <a href="/component/wheels" class="component-nav-btn">
                        <span class="component-nav-icon">üõû</span>
                        <span class="component-nav-label">WHEELS</span>
                        <span class="component-nav-status" id="nav-status-wheels">NORMAL</span>
                    </a>
                    <a href="/component/chassis" class="component-nav-btn">
                        <span class="component-nav-icon">üèóÔ∏è</span>
                        <span class="component-nav-label">CHASSIS</span>
                        <span class="component-nav-status" id="nav-status-chassis">NORMAL</span>
                    </a>
                </div>
            </div>

            <div class="plot-panel">
                <div class="panel-title">
                    <span>üîÆ</span> 3D Sensor Feature Space
                </div>
                <div id="pca-plot"></div>
            </div>
        </div>

        <!-- Center Panel -->
        <div class="center-panel">
            <div class="chart-container">
                <div class="chart-title">üìà Engine Temp & Hydraulic Pressure</div>
                <div id="chart-engine"></div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üìä Vibration & Speed</div>
                <div id="chart-vibration"></div>
            </div>

            <div class="truck-panel">
                <div class="panel-title">
                    <span>üîß</span> Real-Time Diagnostics
                </div>
                <div class="truck-diagram">
                    <!-- ========================================
                         REALISTIC 3D SVG DUMP TRUCK - Heavy Mining Style
                         Photorealistic industrial dump truck with detailed components
                         GREEN glow = healthy, RED glow = anomaly detected
                         ======================================== -->
                    <svg id="dump-truck" class="truck-svg" viewBox="0 0 520 280" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <!-- ============================================
                                 SVG GLOW FILTERS - WORKING DROP SHADOW APPROACH
                                 ============================================ -->
                            <filter id="glow-green" x="-40%" y="-40%" width="180%" height="180%" filterUnits="objectBoundingBox">
                                <feDropShadow dx="0" dy="0" stdDeviation="4" flood-color="#00ff88" flood-opacity="0.8"/>
                            </filter>
                            <filter id="glow-red" x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox">
                                <feDropShadow dx="0" dy="0" stdDeviation="8" flood-color="#ff0000" flood-opacity="1"/>
                                <feDropShadow dx="0" dy="0" stdDeviation="15" flood-color="#ff3333" flood-opacity="0.7"/>
                            </filter>
                            <filter id="glow-red-pulse" x="-60%" y="-60%" width="220%" height="220%" filterUnits="objectBoundingBox">
                                <feDropShadow dx="0" dy="0" stdDeviation="10" flood-color="#ff0000" flood-opacity="1"/>
                                <feDropShadow dx="0" dy="0" stdDeviation="20" flood-color="#ff2222" flood-opacity="0.8"/>
                                <feDropShadow dx="0" dy="0" stdDeviation="30" flood-color="#ff4444" flood-opacity="0.5"/>
                            </filter>
                            
                            <!-- SMOKE BLUR FILTER -->
                            <filter id="smokeBlur" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur in="SourceGraphic" stdDeviation="3"/>
                            </filter>
                            
                            <!-- 3D SHADOW FILTER -->
                            <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="3" dy="4" stdDeviation="3" flood-color="#000" flood-opacity="0.4"/>
                            </filter>
                            
                            <!-- INNER SHADOW FILTER -->
                            <filter id="innerShadow" x="-50%" y="-50%" width="200%" height="200%">
                                <feComponentTransfer in="SourceAlpha">
                                    <feFuncA type="table" tableValues="1 0"/>
                                </feComponentTransfer>
                                <feGaussianBlur stdDeviation="3"/>
                                <feOffset dx="2" dy="3" result="offsetblur"/>
                                <feFlood flood-color="#000" flood-opacity="0.5"/>
                                <feComposite in2="offsetblur" operator="in"/>
                                <feMerge>
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            
                            <!-- METALLIC HIGHLIGHT FILTER -->
                            <filter id="metallic">
                                <feSpecularLighting result="specOut" specularExponent="20" lighting-color="#fff">
                                    <fePointLight x="-5000" y="-10000" z="20000"/>
                                </feSpecularLighting>
                                <feComposite in="SourceGraphic" in2="specOut" operator="arithmetic" k1="0" k2="1" k3="1" k4="0"/>
                            </filter>
                            
                            <!-- REALISTIC CABIN GRADIENT - Yellow/Orange Industrial -->
                            <linearGradient id="cabinGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#FFD54F"/>
                                <stop offset="25%" stop-color="#FFCA28"/>
                                <stop offset="50%" stop-color="#FFC107"/>
                                <stop offset="75%" stop-color="#FFB300"/>
                                <stop offset="100%" stop-color="#FF8F00"/>
                            </linearGradient>
                            
                            <!-- CABIN SIDE GRADIENT - Darker for depth -->
                            <linearGradient id="cabinSideGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#FF8F00"/>
                                <stop offset="50%" stop-color="#EF6C00"/>
                                <stop offset="100%" stop-color="#E65100"/>
                            </linearGradient>
                            
                            <!-- DUMP BED GRADIENT - Steel/Iron look -->
                            <linearGradient id="bedGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#FFD54F"/>
                                <stop offset="15%" stop-color="#FFCA28"/>
                                <stop offset="40%" stop-color="#FFC107"/>
                                <stop offset="70%" stop-color="#FFB300"/>
                                <stop offset="100%" stop-color="#E65100"/>
                            </linearGradient>
                            
                            <!-- BED INNER SHADOW GRADIENT -->
                            <linearGradient id="bedInnerGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#5D4037"/>
                                <stop offset="100%" stop-color="#3E2723"/>
                            </linearGradient>
                            
                            <!-- CHASSIS GRADIENT - Heavy steel -->
                            <linearGradient id="chassisGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#616161"/>
                                <stop offset="30%" stop-color="#424242"/>
                                <stop offset="70%" stop-color="#303030"/>
                                <stop offset="100%" stop-color="#212121"/>
                            </linearGradient>
                            
                            <!-- CHASSIS TOP HIGHLIGHT -->
                            <linearGradient id="chassisTopGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#757575"/>
                                <stop offset="100%" stop-color="#424242"/>
                            </linearGradient>
                            
                            <!-- TIRE GRADIENT - Rubber texture -->
                            <radialGradient id="tireGradient" cx="30%" cy="30%" r="70%" fx="30%" fy="30%">
                                <stop offset="0%" stop-color="#4A4A4A"/>
                                <stop offset="50%" stop-color="#2D2D2D"/>
                                <stop offset="85%" stop-color="#1A1A1A"/>
                                <stop offset="100%" stop-color="#0D0D0D"/>
                            </radialGradient>
                            
                            <!-- WHEEL RIM GRADIENT - Chrome/Steel -->
                            <radialGradient id="rimGradient" cx="35%" cy="35%" r="65%" fx="35%" fy="35%">
                                <stop offset="0%" stop-color="#E0E0E0"/>
                                <stop offset="30%" stop-color="#BDBDBD"/>
                                <stop offset="60%" stop-color="#9E9E9E"/>
                                <stop offset="100%" stop-color="#616161"/>
                            </radialGradient>
                            
                            <!-- HUB CAP GRADIENT -->
                            <radialGradient id="hubGradient" cx="40%" cy="40%" r="60%" fx="40%" fy="40%">
                                <stop offset="0%" stop-color="#FAFAFA"/>
                                <stop offset="40%" stop-color="#BDBDBD"/>
                                <stop offset="100%" stop-color="#757575"/>
                            </radialGradient>
                            
                            <!-- GLASS GRADIENT - Reflective windshield -->
                            <linearGradient id="glassGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#E3F2FD" stop-opacity="0.95"/>
                                <stop offset="30%" stop-color="#90CAF9" stop-opacity="0.85"/>
                                <stop offset="60%" stop-color="#64B5F6" stop-opacity="0.9"/>
                                <stop offset="100%" stop-color="#42A5F5" stop-opacity="0.85"/>
                            </linearGradient>
                            
                            <!-- GLASS REFLECTION -->
                            <linearGradient id="glassReflection" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#fff" stop-opacity="0.6"/>
                                <stop offset="50%" stop-color="#fff" stop-opacity="0"/>
                            </linearGradient>
                            
                            <!-- DIRT/GRAVEL LOAD GRADIENT -->
                            <linearGradient id="loadGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stop-color="#A1887F"/>
                                <stop offset="30%" stop-color="#8D6E63"/>
                                <stop offset="70%" stop-color="#6D4C41"/>
                                <stop offset="100%" stop-color="#5D4037"/>
                            </linearGradient>
                            
                            <!-- HYDRAULIC CYLINDER GRADIENT -->
                            <linearGradient id="hydraulicGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#78909C"/>
                                <stop offset="30%" stop-color="#B0BEC5"/>
                                <stop offset="50%" stop-color="#CFD8DC"/>
                                <stop offset="70%" stop-color="#B0BEC5"/>
                                <stop offset="100%" stop-color="#607D8B"/>
                            </linearGradient>
                            
                            <!-- EXHAUST PIPE GRADIENT -->
                            <linearGradient id="exhaustGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#424242"/>
                                <stop offset="30%" stop-color="#616161"/>
                                <stop offset="50%" stop-color="#757575"/>
                                <stop offset="70%" stop-color="#616161"/>
                                <stop offset="100%" stop-color="#424242"/>
                            </linearGradient>
                            
                            <!-- HEADLIGHT GLOW -->
                            <radialGradient id="headlightGlow" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" stop-color="#FFFDE7"/>
                                <stop offset="40%" stop-color="#FFF9C4"/>
                                <stop offset="100%" stop-color="#FFF176"/>
                            </radialGradient>
                            
                            <!-- TIRE TREAD PATTERN -->
                            <pattern id="treadPattern" x="0" y="0" width="8" height="8" patternUnits="userSpaceOnUse">
                                <rect width="8" height="8" fill="#1A1A1A"/>
                                <rect x="1" y="1" width="3" height="6" fill="#2A2A2A"/>
                            </pattern>
                        </defs>
                        
                        <!-- ======== GROUND SHADOW - More realistic ======== -->
                        <ellipse cx="270" cy="258" rx="230" ry="18" fill="rgba(0,0,0,0.5)">
                            <animate attributeName="opacity" values="0.5;0.4;0.5" dur="2s" repeatCount="indefinite"/>
                        </ellipse>
                        <ellipse cx="270" cy="256" rx="200" ry="12" fill="rgba(0,0,0,0.3)"/>
                        
                        <!-- ============================================
                             COMPONENT: CHASSIS - Heavy duty steel frame
                             ID: truck-chassis
                             ============================================ -->
                        <g id="truck-chassis" class="svg-normal" filter="url(#dropShadow)">
                            <!-- Main chassis beam - I-beam style -->
                            <rect x="45" y="175" width="420" height="28" rx="3" fill="url(#chassisGradient)"/>
                            <rect x="45" y="175" width="420" height="6" rx="2" fill="url(#chassisTopGradient)"/>
                            
                            <!-- Cross members with rivets -->
                            <rect x="130" y="178" width="12" height="22" fill="#37474F"/>
                            <circle cx="136" cy="182" r="2" fill="#546E7A"/>
                            <circle cx="136" cy="196" r="2" fill="#546E7A"/>
                            
                            <rect x="200" y="178" width="12" height="22" fill="#37474F"/>
                            <circle cx="206" cy="182" r="2" fill="#546E7A"/>
                            <circle cx="206" cy="196" r="2" fill="#546E7A"/>
                            
                            <rect x="270" y="178" width="12" height="22" fill="#37474F"/>
                            <circle cx="276" cy="182" r="2" fill="#546E7A"/>
                            <circle cx="276" cy="196" r="2" fill="#546E7A"/>
                            
                            <!-- Front axle housing -->
                            <rect x="75" y="195" width="65" height="20" rx="5" fill="#37474F"/>
                            <rect x="75" y="195" width="65" height="5" rx="3" fill="#546E7A"/>
                            <ellipse cx="107" cy="205" rx="8" ry="5" fill="#263238"/>
                            
                            <!-- Rear tandem axle housing -->
                            <rect x="300" y="195" width="140" height="20" rx="5" fill="#37474F"/>
                            <rect x="300" y="195" width="140" height="5" rx="3" fill="#546E7A"/>
                            <ellipse cx="340" cy="205" rx="8" ry="5" fill="#263238"/>
                            <ellipse cx="400" cy="205" rx="8" ry="5" fill="#263238"/>
                            
                            <!-- Suspension leaf springs -->
                            <path d="M80 190 Q107 185, 135 190" stroke="#455A64" stroke-width="4" fill="none"/>
                            <path d="M305 190 Q370 182, 435 190" stroke="#455A64" stroke-width="4" fill="none"/>
                        </g>
                        
                        <!-- ============================================
                             COMPONENT: HYDRAULICS - Dump Bed with cylinder
                             ID: truck-hydraulics
                             ============================================ -->
                        <g id="truck-hydraulics" class="svg-normal" filter="url(#dropShadow)">
                            <!-- Dump bed - angled with depth -->
                            <path d="M175 75 L175 168 L475 168 L495 75 Z" fill="url(#bedGradient)" stroke="#E65100" stroke-width="2"/>
                            
                            <!-- Inner bed shadow for depth -->
                            <path d="M180 80 L180 163 L470 163 L488 80 Z" fill="url(#bedInnerGradient)" opacity="0.3"/>
                            
                            <!-- Bed reinforcement ribs - 3D style -->
                            <g stroke="#E65100" stroke-width="3">
                                <line x1="210" y1="80" x2="195" y2="163"/>
                                <line x1="255" y1="80" x2="235" y2="163"/>
                                <line x1="300" y1="80" x2="275" y2="163"/>
                                <line x1="345" y1="80" x2="315" y2="163"/>
                                <line x1="390" y1="80" x2="355" y2="163"/>
                                <line x1="435" y1="80" x2="395" y2="163"/>
                                <line x1="475" y1="80" x2="430" y2="163"/>
                            </g>
                            
                            <!-- Rib highlights -->
                            <g stroke="#FFE082" stroke-width="1" opacity="0.5">
                                <line x1="212" y1="80" x2="197" y2="163"/>
                                <line x1="257" y1="80" x2="237" y2="163"/>
                                <line x1="302" y1="80" x2="277" y2="163"/>
                            </g>
                            
                            <!-- Top rail with 3D effect -->
                            <rect x="173" y="65" width="325" height="14" rx="3" fill="#FFB300"/>
                            <rect x="173" y="65" width="325" height="5" rx="2" fill="#FFCA28"/>
                            
                            <!-- Tailgate -->
                            <rect x="470" y="75" width="8" height="93" fill="#E65100"/>
                            <rect x="470" y="75" width="3" height="93" fill="#FF8F00"/>
                            
                            <!-- Dirt/Rock Load - realistic mound -->
                            <ellipse cx="335" cy="62" rx="135" ry="28" fill="url(#loadGradient)"/>
                            <ellipse cx="310" cy="55" rx="95" ry="18" fill="#795548"/>
                            <ellipse cx="370" cy="52" rx="70" ry="15" fill="#6D4C41"/>
                            <!-- Rock details -->
                            <circle cx="280" cy="58" r="8" fill="#5D4037"/>
                            <circle cx="350" cy="50" r="6" fill="#4E342E"/>
                            <circle cx="400" cy="55" r="7" fill="#5D4037"/>
                            <circle cx="320" cy="48" r="5" fill="#3E2723"/>
                            
                            <!-- HYDRAULIC SYSTEM - Main cylinder -->
                            <g>
                                <!-- Cylinder mount bracket -->
                                <rect x="185" y="155" width="25" height="18" rx="3" fill="#455A64"/>
                                <rect x="185" y="155" width="25" height="5" rx="2" fill="#607D8B"/>
                                
                                <!-- Main hydraulic cylinder -->
                                <rect x="190" y="115" width="16" height="45" rx="4" fill="url(#hydraulicGradient)"/>
                                
                                <!-- Piston rod -->
                                <rect x="194" y="85" width="8" height="35" rx="2" fill="#CFD8DC"/>
                                <rect x="194" y="85" width="3" height="35" fill="#ECEFF1"/>
                                
                                <!-- Cylinder cap -->
                                <ellipse cx="198" cy="85" rx="10" ry="5" fill="#78909C"/>
                                <ellipse cx="198" cy="85" rx="6" ry="3" fill="#B0BEC5"/>
                                
                                <!-- Hydraulic lines -->
                                <path d="M200 160 Q215 165, 230 160" stroke="#37474F" stroke-width="3" fill="none"/>
                                <path d="M200 165 Q220 172, 240 165" stroke="#37474F" stroke-width="2" fill="none"/>
                            </g>
                        </g>
                        
                        <!-- ============================================
                             COMPONENT: ENGINE - Realistic Cabin
                             ID: truck-engine
                             ============================================ -->
                        <g id="truck-engine" class="svg-normal" filter="url(#dropShadow)">
                            <!-- Cabin main body -->
                            <path d="M42 95 L42 172 L175 172 L175 82 L130 52 L65 52 L42 80 Z" fill="url(#cabinGradient)" stroke="#E65100" stroke-width="2"/>
                            
                            <!-- Cabin side panel (darker) -->
                            <path d="M42 95 L42 172 L50 172 L50 90 Z" fill="url(#cabinSideGradient)"/>
                            
                            <!-- Cabin roof with sunvisor -->
                            <rect x="60" y="42" width="75" height="14" rx="4" fill="#FFA000"/>
                            <rect x="60" y="42" width="75" height="5" rx="3" fill="#FFB300"/>
                            <rect x="55" y="50" width="85" height="6" rx="2" fill="#E65100"/>
                            
                            <!-- Front windshield - curved with reflection -->
                            <path d="M50 85 L68 56 L125 56 L125 85 Z" fill="url(#glassGradient)" stroke="#1565C0" stroke-width="2"/>
                            <path d="M55 82 L70 60 L95 60 L95 75 Z" fill="url(#glassReflection)"/>
                            
                            <!-- Side window with frame -->
                            <rect x="95" y="62" width="75" height="50" rx="4" fill="url(#glassGradient)" stroke="#1565C0" stroke-width="2"/>
                            <path d="M100 67 L130 67 L130 90 L100 90 Z" fill="url(#glassReflection)"/>
                            
                            <!-- Window divider -->
                            <rect x="138" y="62" width="4" height="50" fill="#E65100"/>
                            
                            <!-- Door with handle and details -->
                            <rect x="90" y="80" width="80" height="88" rx="3" fill="none" stroke="#E65100" stroke-width="3"/>
                            <!-- Door handle assembly -->
                            <rect x="98" y="122" width="28" height="10" rx="4" fill="#455A64"/>
                            <rect x="98" y="122" width="28" height="4" rx="2" fill="#607D8B"/>
                            <rect x="102" y="120" width="8" height="14" rx="2" fill="#37474F"/>
                            
                            <!-- Door hinges -->
                            <rect x="168" y="90" width="4" height="12" rx="1" fill="#455A64"/>
                            <rect x="168" y="130" width="4" height="12" rx="1" fill="#455A64"/>
                            
                            <!-- Headlight assembly - realistic -->
                            <ellipse cx="48" cy="140" rx="14" ry="16" fill="#263238"/>
                            <ellipse cx="48" cy="140" rx="12" ry="14" fill="url(#headlightGlow)"/>
                            <ellipse cx="46" cy="138" rx="6" ry="7" fill="#fff"/>
                            <ellipse cx="44" cy="136" rx="2" ry="3" fill="#FFEB3B"/>
                            
                            <!-- Turn signal -->
                            <rect x="36" y="155" width="16" height="8" rx="2" fill="#FF9800"/>
                            <rect x="36" y="155" width="16" height="3" rx="1" fill="#FFB74D"/>
                            
                            <!-- Side mirror - chrome style -->
                            <rect x="32" y="72" width="10" height="28" rx="3" fill="#37474F"/>
                            <rect x="22" y="78" width="16" height="18" rx="3" fill="#64B5F6" stroke="#455A64" stroke-width="2"/>
                            <rect x="24" y="80" width="8" height="10" fill="#E3F2FD" opacity="0.5"/>
                            
                            <!-- EXHAUST STACK - Vertical chrome pipe -->
                            <rect x="158" y="25" width="14" height="58" rx="4" fill="url(#exhaustGradient)"/>
                            <rect x="160" y="25" width="4" height="58" fill="#9E9E9E" opacity="0.4"/>
                            <ellipse cx="165" cy="25" rx="8" ry="5" fill="#424242"/>
                            <ellipse cx="165" cy="25" rx="5" ry="3" fill="#212121"/>
                            
                            <!-- Rain cap on exhaust -->
                            <ellipse cx="165" cy="22" rx="10" ry="4" fill="#616161"/>
                            
                            <!-- Front bumper - heavy duty -->
                            <rect x="32" y="165" width="150" height="15" rx="4" fill="#37474F"/>
                            <rect x="32" y="165" width="150" height="5" rx="3" fill="#546E7A"/>
                            
                            <!-- Front grille - modern style -->
                            <rect x="40" y="145" width="35" height="22" rx="4" fill="#263238"/>
                            <line x1="47" y1="148" x2="47" y2="164" stroke="#37474F" stroke-width="4"/>
                            <line x1="57" y1="148" x2="57" y2="164" stroke="#37474F" stroke-width="4"/>
                            <line x1="67" y1="148" x2="67" y2="164" stroke="#37474F" stroke-width="4"/>
                            
                            <!-- Air intake -->
                            <rect x="78" y="148" width="18" height="18" rx="3" fill="#263238"/>
                            <rect x="80" y="150" width="14" height="14" rx="2" fill="#1A1A1A"/>
                            
                            <!-- Hood details -->
                            <rect x="44" y="130" width="30" height="16" rx="3" fill="#FF8F00"/>
                            <rect x="44" y="130" width="30" height="4" rx="2" fill="#FFA726"/>
                            
                            <!-- CAT/Brand badge area -->
                            <rect x="100" y="142" width="40" height="12" rx="2" fill="#E65100"/>
                            <rect x="102" y="144" width="36" height="8" rx="1" fill="#FFB300"/>
                        </g>
                        
                        <!-- ============================================
                             COMPONENT: WHEELS - Heavy duty mining tires
                             ID: truck-wheels
                             ============================================ -->
                        <g id="truck-wheels" class="svg-normal">
                            <!-- FRONT WHEEL - Large mining tire -->
                            <g id="wheel-front" filter="url(#dropShadow)">
                                <!-- Outer tire -->
                                <circle cx="107" cy="218" r="42" fill="url(#tireGradient)"/>
                                <!-- Tire sidewall detail -->
                                <circle cx="107" cy="218" r="38" fill="none" stroke="#3D3D3D" stroke-width="3"/>
                                <!-- Tread pattern -->
                                <circle cx="107" cy="218" r="40" fill="none" stroke="#1A1A1A" stroke-width="6" stroke-dasharray="12 6"/>
                                <circle cx="107" cy="218" r="35" fill="none" stroke="#2D2D2D" stroke-width="4" stroke-dasharray="8 8"/>
                                <!-- Wheel rim -->
                                <circle cx="107" cy="218" r="24" fill="url(#rimGradient)"/>
                                <circle cx="107" cy="218" r="20" fill="#757575"/>
                                <!-- Hub cap -->
                                <circle cx="107" cy="218" r="14" fill="url(#hubGradient)"/>
                                <!-- Lug nuts -->
                                <circle cx="107" cy="206" r="3" fill="#9E9E9E"/>
                                <circle cx="107" cy="230" r="3" fill="#9E9E9E"/>
                                <circle cx="119" cy="218" r="3" fill="#9E9E9E"/>
                                <circle cx="95" cy="218" r="3" fill="#9E9E9E"/>
                                <circle cx="115" cy="209" r="3" fill="#9E9E9E"/>
                                <circle cx="99" cy="227" r="3" fill="#9E9E9E"/>
                                <!-- Center cap -->
                                <circle cx="107" cy="218" r="6" fill="#BDBDBD"/>
                                <circle cx="105" cy="216" r="2" fill="#E0E0E0"/>
                            </g>
                            
                            <!-- REAR WHEEL 1 - Dual tire setup -->
                            <g id="wheel-rear1" filter="url(#dropShadow)">
                                <circle cx="340" cy="218" r="42" fill="url(#tireGradient)"/>
                                <circle cx="340" cy="218" r="38" fill="none" stroke="#3D3D3D" stroke-width="3"/>
                                <circle cx="340" cy="218" r="40" fill="none" stroke="#1A1A1A" stroke-width="6" stroke-dasharray="12 6"/>
                                <circle cx="340" cy="218" r="35" fill="none" stroke="#2D2D2D" stroke-width="4" stroke-dasharray="8 8"/>
                                <circle cx="340" cy="218" r="24" fill="url(#rimGradient)"/>
                                <circle cx="340" cy="218" r="20" fill="#757575"/>
                                <circle cx="340" cy="218" r="14" fill="url(#hubGradient)"/>
                                <circle cx="340" cy="206" r="3" fill="#9E9E9E"/>
                                <circle cx="340" cy="230" r="3" fill="#9E9E9E"/>
                                <circle cx="352" cy="218" r="3" fill="#9E9E9E"/>
                                <circle cx="328" cy="218" r="3" fill="#9E9E9E"/>
                                <circle cx="348" cy="209" r="3" fill="#9E9E9E"/>
                                <circle cx="332" cy="227" r="3" fill="#9E9E9E"/>
                                <circle cx="340" cy="218" r="6" fill="#BDBDBD"/>
                                <circle cx="338" cy="216" r="2" fill="#E0E0E0"/>
                            </g>
                            
                            <!-- REAR WHEEL 2 -->
                            <g id="wheel-rear2" filter="url(#dropShadow)">
                                <circle cx="408" cy="218" r="42" fill="url(#tireGradient)"/>
                                <circle cx="408" cy="218" r="38" fill="none" stroke="#3D3D3D" stroke-width="3"/>
                                <circle cx="408" cy="218" r="40" fill="none" stroke="#1A1A1A" stroke-width="6" stroke-dasharray="12 6"/>
                                <circle cx="408" cy="218" r="35" fill="none" stroke="#2D2D2D" stroke-width="4" stroke-dasharray="8 8"/>
                                <circle cx="408" cy="218" r="24" fill="url(#rimGradient)"/>
                                <circle cx="408" cy="218" r="20" fill="#757575"/>
                                <circle cx="408" cy="218" r="14" fill="url(#hubGradient)"/>
                                <circle cx="408" cy="206" r="3" fill="#9E9E9E"/>
                                <circle cx="408" cy="230" r="3" fill="#9E9E9E"/>
                                <circle cx="420" cy="218" r="3" fill="#9E9E9E"/>
                                <circle cx="396" cy="218" r="3" fill="#9E9E9E"/>
                                <circle cx="416" cy="209" r="3" fill="#9E9E9E"/>
                                <circle cx="400" cy="227" r="3" fill="#9E9E9E"/>
                                <circle cx="408" cy="218" r="6" fill="#BDBDBD"/>
                                <circle cx="406" cy="216" r="2" fill="#E0E0E0"/>
                            </g>
                            
                            <!-- Mud flaps -->
                            <rect x="145" y="200" width="18" height="35" rx="2" fill="#263238"/>
                            <rect x="280" y="200" width="18" height="35" rx="2" fill="#263238"/>
                            <rect x="445" y="200" width="18" height="35" rx="2" fill="#263238"/>
                        </g>
                        
                        <!-- ============================================
                             SMOKE EFFECTS - Appear on anomaly detection
                             Each component has its own smoke group
                             ============================================ -->
                        
                        <!-- SMOKE: ENGINE (from exhaust stack area) -->
                        <g id="smoke-engine" class="smoke-group">
                            <!-- Main smoke puffs rising from exhaust -->
                            <ellipse class="smoke-puff smoke-puff-1" cx="165" cy="25" rx="8" ry="6" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-2" cx="162" cy="18" rx="10" ry="7" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-3" cx="168" cy="10" rx="12" ry="8" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-4" cx="160" cy="5" rx="9" ry="6" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-5" cx="170" cy="0" rx="11" ry="7" filter="url(#smokeBlur)"/>
                            <!-- Wispy secondary smoke -->
                            <ellipse class="smoke-wisp smoke-wisp-1" cx="158" cy="22" rx="6" ry="5" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-2" cx="172" cy="15" rx="7" ry="5" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-3" cx="163" cy="8" rx="8" ry="6" filter="url(#smokeBlur)"/>
                            <!-- Dark smoke particles -->
                            <ellipse class="smoke-dark smoke-dark-1" cx="165" cy="20" rx="5" ry="4" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-dark smoke-dark-2" cx="167" cy="12" rx="6" ry="4" filter="url(#smokeBlur)"/>
                        </g>
                        
                        <!-- SMOKE: HYDRAULICS (from hydraulic cylinder area) -->
                        <g id="smoke-hydraulics" class="smoke-group">
                            <!-- Smoke from hydraulic system -->
                            <ellipse class="smoke-puff smoke-puff-1" cx="197" cy="110" rx="10" ry="7" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-2" cx="200" cy="100" rx="12" ry="8" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-3" cx="195" cy="90" rx="14" ry="9" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-4" cx="202" cy="80" rx="11" ry="7" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-5" cx="193" cy="70" rx="13" ry="8" filter="url(#smokeBlur)"/>
                            <!-- Wispy smoke -->
                            <ellipse class="smoke-wisp smoke-wisp-1" cx="190" cy="105" rx="7" ry="5" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-2" cx="205" cy="95" rx="8" ry="6" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-3" cx="188" cy="85" rx="9" ry="6" filter="url(#smokeBlur)"/>
                            <!-- Dark particles -->
                            <ellipse class="smoke-dark smoke-dark-1" cx="197" cy="98" rx="6" ry="5" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-dark smoke-dark-2" cx="200" cy="88" rx="7" ry="5" filter="url(#smokeBlur)"/>
                        </g>
                        
                        <!-- SMOKE: CHASSIS (from center chassis area) -->
                        <g id="smoke-chassis" class="smoke-group">
                            <!-- Smoke rising from chassis -->
                            <ellipse class="smoke-puff smoke-puff-1" cx="220" cy="160" rx="12" ry="8" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-2" cx="225" cy="148" rx="14" ry="9" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-3" cx="218" cy="135" rx="16" ry="10" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-4" cx="228" cy="122" rx="13" ry="8" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-5" cx="215" cy="110" rx="15" ry="9" filter="url(#smokeBlur)"/>
                            <!-- Wispy secondary -->
                            <ellipse class="smoke-wisp smoke-wisp-1" cx="210" cy="155" rx="8" ry="6" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-2" cx="235" cy="140" rx="9" ry="6" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-3" cx="212" cy="128" rx="10" ry="7" filter="url(#smokeBlur)"/>
                            <!-- Dark smoke -->
                            <ellipse class="smoke-dark smoke-dark-1" cx="222" cy="145" rx="7" ry="5" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-dark smoke-dark-2" cx="220" cy="130" rx="8" ry="6" filter="url(#smokeBlur)"/>
                        </g>
                        
                        <!-- SMOKE: WHEELS (from wheel/brake area) -->
                        <g id="smoke-wheels" class="smoke-group">
                            <!-- Front wheel smoke -->
                            <ellipse class="smoke-puff smoke-puff-1" cx="107" cy="175" rx="10" ry="7" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-2" cx="105" cy="162" rx="12" ry="8" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-3" cx="110" cy="150" rx="14" ry="9" filter="url(#smokeBlur)"/>
                            <!-- Rear wheel 1 smoke -->
                            <ellipse class="smoke-puff smoke-puff-4" cx="340" cy="175" rx="10" ry="7" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-puff smoke-puff-5" cx="342" cy="162" rx="12" ry="8" filter="url(#smokeBlur)"/>
                            <!-- Rear wheel 2 smoke -->
                            <ellipse class="smoke-wisp smoke-wisp-1" cx="408" cy="175" rx="10" ry="7" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-2" cx="406" cy="162" rx="12" ry="8" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-wisp smoke-wisp-3" cx="410" cy="150" rx="14" ry="9" filter="url(#smokeBlur)"/>
                            <!-- Dark particles from brakes -->
                            <ellipse class="smoke-dark smoke-dark-1" cx="107" cy="168" rx="6" ry="5" filter="url(#smokeBlur)"/>
                            <ellipse class="smoke-dark smoke-dark-2" cx="374" cy="168" rx="8" ry="6" filter="url(#smokeBlur)"/>
                        </g>
                    </svg>
                    
                    <!-- ======== FLOATING DIAGNOSTIC LABELS ======== -->
                    <div class="component-label component-normal" id="engine-label">
                        <span class="component-dot"></span>ENGINE
                    </div>
                    <div class="component-label component-normal" id="hydraulic-label">
                        <span class="component-dot"></span>HYDRAULICS
                    </div>
                    <div class="component-label component-normal" id="chassis-label">
                        <span class="component-dot"></span>CHASSIS
                    </div>
                    <div class="component-label component-normal" id="wheels-label">
                        <span class="component-dot"></span>WHEELS
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div class="sensor-panel">
                <div class="panel-title">
                    <span>üì°</span> Sensor Readings
                </div>
                <div class="sensor-grid" id="sensor-grid">
                    <!-- Sensors will be dynamically populated -->
                </div>
            </div>

            <!-- Failure Probability Panel -->
            <div class="probability-panel">
                <div class="panel-title">
                    <span>üìä</span> Failure Probability
                </div>
                <div class="probability-grid" id="probability-grid">
                    <!-- Engine -->
                    <div class="probability-item" id="prob-engine">
                        <div class="probability-header">
                            <span class="prob-component">üî• Engine</span>
                            <span class="prob-percentage" id="prob-engine-pct">40%</span>
                        </div>
                        <div class="probability-bar-container">
                            <div class="probability-bar engine" id="prob-engine-bar" style="width: 40%;"></div>
                        </div>
                        <div class="prob-status">
                            <span class="prob-status-dot" id="prob-engine-dot"></span>
                            <span id="prob-engine-status">Normal</span>
                        </div>
                    </div>
                    <!-- Hydraulic -->
                    <div class="probability-item" id="prob-hydraulic">
                        <div class="probability-header">
                            <span class="prob-component">üíß Hydraulics</span>
                            <span class="prob-percentage" id="prob-hydraulic-pct">30%</span>
                        </div>
                        <div class="probability-bar-container">
                            <div class="probability-bar hydraulic" id="prob-hydraulic-bar" style="width: 30%;"></div>
                        </div>
                        <div class="prob-status">
                            <span class="prob-status-dot" id="prob-hydraulic-dot"></span>
                            <span id="prob-hydraulic-status">Normal</span>
                        </div>
                    </div>
                    <!-- Wheels -->
                    <div class="probability-item" id="prob-wheels">
                        <div class="probability-header">
                            <span class="prob-component">‚öôÔ∏è Wheels</span>
                            <span class="prob-percentage" id="prob-wheels-pct">20%</span>
                        </div>
                        <div class="probability-bar-container">
                            <div class="probability-bar wheels" id="prob-wheels-bar" style="width: 20%;"></div>
                        </div>
                        <div class="prob-status">
                            <span class="prob-status-dot" id="prob-wheels-dot"></span>
                            <span id="prob-wheels-status">Normal</span>
                        </div>
                    </div>
                    <!-- Chassis -->
                    <div class="probability-item" id="prob-chassis">
                        <div class="probability-header">
                            <span class="prob-component">üõ°Ô∏è Chassis</span>
                            <span class="prob-percentage" id="prob-chassis-pct">10%</span>
                        </div>
                        <div class="probability-bar-container">
                            <div class="probability-bar chassis" id="prob-chassis-bar" style="width: 10%;"></div>
                        </div>
                        <div class="prob-status">
                            <span class="prob-status-dot" id="prob-chassis-dot"></span>
                            <span id="prob-chassis-status">Normal</span>
                        </div>
                    </div>
                </div>
                <div class="probability-legend">
                    ‚ö†Ô∏è Higher % = More likely to fail when injection is active
                </div>
            </div>

            <div class="sim-controls">
                <div class="panel-title">
                    <span>üéÆ</span> Quick Controls
                </div>
                <div class="sim-buttons">
                    <button class="btn btn-normal" onclick="startStream()">‚ñ∂ Start Stream</button>
                    <button class="btn btn-danger" onclick="stopStream()">‚èπ Stop</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let simulationInterval = null;
        let isStreaming = false;
        let injectionActive = false;
        let activeFailedComponents = [];  // Track which components are currently failing
        
        // PCA scatter data (now used for actual sensor values)
        let pcaNormalX = [], pcaNormalY = [], pcaNormalZ = [];
        let pcaAnomalyX = [], pcaAnomalyY = [], pcaAnomalyZ = [];
        // Hover text arrays for showing actual sensor values
        let pcaNormalHover = [], pcaAnomalyHover = [];
        const MAX_PCA_POINTS = 200;

        // Initialize plots
        function initPlots() {
            // 3D Sensor Feature Plot (using actual sensor values)
            const pcaLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(10,10,30,0.5)',
                margin: { l: 0, r: 0, t: 0, b: 0 },
                scene: {
                    xaxis: { 
                        title: { text: 'Engine Temp (¬∞C)', font: { color: '#888', size: 11 } }, 
                        showgrid: true, 
                        gridcolor: '#1a3a5c',
                        zerolinecolor: '#1a3a5c',
                        showticklabels: true,
                        tickfont: { color: '#666', size: 9 }
                    },
                    yaxis: { 
                        title: { text: 'Hydraulic Pressure (bar)', font: { color: '#888', size: 11 } }, 
                        showgrid: true, 
                        gridcolor: '#1a3a5c',
                        zerolinecolor: '#1a3a5c',
                        showticklabels: true,
                        tickfont: { color: '#666', size: 9 }
                    },
                    zaxis: { 
                        title: { text: 'Vibration (mm/s)', font: { color: '#888', size: 11 } }, 
                        showgrid: true, 
                        gridcolor: '#1a3a5c',
                        zerolinecolor: '#1a3a5c',
                        showticklabels: true,
                        tickfont: { color: '#666', size: 9 }
                    },
                    bgcolor: 'rgba(10,10,30,0.5)',
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.2 }
                    }
                },
                showlegend: false
            };

            Plotly.newPlot('pca-plot', [
                {
                    x: [], y: [], z: [],
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: { size: 4, color: '#00ff88', opacity: 0.7 },
                    name: 'Normal',
                    hovertemplate: '<b>Normal Reading</b><br>' +
                        'Engine Temp: %{x:.1f}¬∞C<br>' +
                        'Hydraulic Pressure: %{y:.1f} bar<br>' +
                        'Vibration: %{z:.2f} mm/s<extra></extra>'
                },
                {
                    x: [], y: [], z: [],
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: { size: 6, color: '#ff4444', opacity: 0.9 },
                    name: 'Anomaly',
                    hovertemplate: '<b>‚ö†Ô∏è ANOMALY</b><br>' +
                        'Engine Temp: %{x:.1f}¬∞C<br>' +
                        'Hydraulic Pressure: %{y:.1f} bar<br>' +
                        'Vibration: %{z:.2f} mm/s<extra></extra>'
                }
            ], pcaLayout, { responsive: true, displayModeBar: false });

            // Time series charts
            const chartLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(10,10,30,0.3)',
                margin: { l: 40, r: 10, t: 10, b: 30 },
                xaxis: { 
                    showgrid: true, 
                    gridcolor: '#1a3a5c',
                    color: '#888'
                },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: '#1a3a5c',
                    color: '#888'
                },
                showlegend: true,
                legend: { 
                    x: 0, 
                    y: 1, 
                    font: { color: '#888', size: 10 },
                    bgcolor: 'rgba(0,0,0,0)'
                }
            };

            Plotly.newPlot('chart-engine', [
                { x: [], y: [], mode: 'lines', name: 'Engine Temp', line: { color: '#ff6b6b', width: 2 } },
                { x: [], y: [], mode: 'lines', name: 'Hydraulic', line: { color: '#ffd93d', width: 2 } }
            ], chartLayout, { responsive: true, displayModeBar: false });

            Plotly.newPlot('chart-vibration', [
                { x: [], y: [], mode: 'lines', name: 'Vibration', line: { color: '#ff6b6b', width: 2 } },
                { x: [], y: [], mode: 'lines', name: 'Speed', line: { color: '#6bcb77', width: 2 } }
            ], chartLayout, { responsive: true, displayModeBar: false });
        }

        // Update 3D Sensor Feature plot with actual sensor values
        // X: Engine Temperature (¬∞C), Y: Hydraulic Pressure (bar), Z: Vibration (mm/s)
        function updatePCAPlot(coords, isAnomaly) {
            if (isAnomaly) {
                pcaAnomalyX.push(coords[0]);
                pcaAnomalyY.push(coords[1]);
                pcaAnomalyZ.push(coords[2]);
                
                if (pcaAnomalyX.length > MAX_PCA_POINTS / 4) {
                    pcaAnomalyX.shift();
                    pcaAnomalyY.shift();
                    pcaAnomalyZ.shift();
                }
            } else {
                pcaNormalX.push(coords[0]);
                pcaNormalY.push(coords[1]);
                pcaNormalZ.push(coords[2]);
                
                if (pcaNormalX.length > MAX_PCA_POINTS) {
                    pcaNormalX.shift();
                    pcaNormalY.shift();
                    pcaNormalZ.shift();
                }
            }

            Plotly.update('pca-plot', {
                x: [pcaNormalX, pcaAnomalyX],
                y: [pcaNormalY, pcaAnomalyY],
                z: [pcaNormalZ, pcaAnomalyZ]
            });
        }

        // Update time series charts
        function updateCharts(timeSeries) {
            const timestamps = timeSeries.timestamps;
            
            Plotly.update('chart-engine', {
                x: [timestamps, timestamps],
                y: [timeSeries.engine_temp, timeSeries.hydraulic_pressure]
            });

            Plotly.update('chart-vibration', {
                x: [timestamps, timestamps],
                y: [timeSeries.vibration, timeSeries.speed]
            });
        }

        // Update sensor readings with PER-SENSOR anomaly highlighting
        // Only sensors in anomalousParams will turn RED, others stay GREEN
        function updateSensorReadings(sensors, isAnomaly, anomalousParams = []) {
            const grid = document.getElementById('sensor-grid');
            grid.innerHTML = '';
            
            for (const [name, value] of Object.entries(sensors)) {
                const card = document.createElement('div');
                // Check if THIS SPECIFIC sensor is in the anomalous list
                const isSensorAnomalous = anomalousParams.includes(name);
                card.className = 'sensor-card' + (isSensorAnomalous ? ' anomaly' : '');
                card.innerHTML = `
                    <div class="sensor-name">${name}</div>
                    <div class="sensor-value">${value.toFixed(2)}</div>
                `;
                grid.appendChild(card);
            }
        }

        // Update system status
        function updateSystemStatus(isAnomaly, reconError, threshold) {
            const statusBox = document.getElementById('system-status');
            const statusText = document.getElementById('status-text');
            const reconDisplay = document.getElementById('recon-error');
            const thresholdDisplay = document.getElementById('threshold-value');

            reconDisplay.textContent = reconError.toFixed(4);
            thresholdDisplay.textContent = threshold.toFixed(4);

            if (isAnomaly) {
                statusBox.className = 'system-status status-anomaly';
                statusText.textContent = '‚ö†Ô∏è ANOMALY DETECTED';
            } else {
                statusBox.className = 'system-status status-normal';
                statusText.textContent = 'SYSTEM NORMAL';
            }
        }

        // ============================================================
        // UPDATE TRUCK COMPONENTS - APPLY GLOW VIA CSS CLASSES ONLY
        // CSS drop-shadow is more reliable than SVG filters
        // Also controls SMOKE visibility for each component
        // ============================================================
        function updateTruckComponents(affected) {
            // EXACT MAPPING: Backend key ‚Üí SVG group ID
            const COMPONENT_MAP = {
                'engine': 'truck-engine',
                'hydraulic': 'truck-hydraulics',
                'chassis': 'truck-chassis',
                'wheels': 'truck-wheels'
            };
            
            // EXACT MAPPING: Backend key ‚Üí Label ID
            const LABEL_MAP = {
                'engine': 'engine-label',
                'hydraulic': 'hydraulic-label',
                'chassis': 'chassis-label',
                'wheels': 'wheels-label'
            };
            
            // EXACT MAPPING: Backend key ‚Üí Smoke group ID
            const SMOKE_MAP = {
                'engine': 'smoke-engine',
                'hydraulic': 'smoke-hydraulics',
                'chassis': 'smoke-chassis',
                'wheels': 'smoke-wheels'
            };
            
            // Debug: Log what we received from backend
            console.log('[updateTruckComponents] affected_components:', JSON.stringify(affected));
            
            // Process EACH component independently
            Object.keys(COMPONENT_MAP).forEach(componentKey => {
                const svgGroupId = COMPONENT_MAP[componentKey];
                const labelId = LABEL_MAP[componentKey];
                const smokeId = SMOKE_MAP[componentKey];
                
                // Get DOM elements
                const svgGroup = document.getElementById(svgGroupId);
                const label = document.getElementById(labelId);
                const smokeGroup = document.getElementById(smokeId);
                
                // Determine if this component has an anomaly
                const hasAnomaly = affected && affected[componentKey] === true;
                
                // =====================================================
                // APPLY GLOW USING CSS CLASSES ONLY (more reliable)
                // =====================================================
                if (svgGroup) {
                    // Remove SVG filter attribute completely
                    svgGroup.removeAttribute('filter');
                    
                    // Remove all glow classes first
                    svgGroup.classList.remove('svg-anomaly', 'svg-normal');
                    
                    if (hasAnomaly) {
                        // ANOMALY: Apply RED glow via CSS class
                        svgGroup.classList.add('svg-anomaly');
                        console.log(`‚úÖ [${componentKey}] RED GLOW APPLIED`);
                    } else {
                        // HEALTHY: Apply GREEN glow via CSS class
                        svgGroup.classList.add('svg-normal');
                    }
                } else {
                    console.error(`‚ùå [${componentKey}] SVG group NOT FOUND: ${svgGroupId}`);
                }
                
                // =====================================================
                // SMOKE EFFECT - Show only when anomaly detected
                // =====================================================
                if (smokeGroup) {
                    if (hasAnomaly) {
                        // ANOMALY: Show smoke animation
                        smokeGroup.classList.add('smoke-active');
                        console.log(`üí® [${componentKey}] SMOKE ACTIVATED`);
                    } else {
                        // HEALTHY: Hide smoke immediately
                        smokeGroup.classList.remove('smoke-active');
                    }
                } else {
                    console.warn(`‚ö†Ô∏è [${componentKey}] Smoke group NOT FOUND: ${smokeId}`);
                }
                
                // Update floating label
                if (label) {
                    if (hasAnomaly) {
                        label.className = 'component-label component-fault';
                    } else {
                        label.className = 'component-label component-normal';
                    }
                }
            });
        }

        // ============================================================
        // UPDATE FAILURE PROBABILITY PANEL
        // Shows weighted probabilities and highlights failing components
        // ============================================================
        function updateFailureProbabilities(probabilities, failedComponents) {
            const components = ['engine', 'hydraulic', 'wheels', 'chassis'];
            
            components.forEach(comp => {
                const item = document.getElementById(`prob-${comp}`);
                const pctElement = document.getElementById(`prob-${comp}-pct`);
                const barElement = document.getElementById(`prob-${comp}-bar`);
                const dotElement = document.getElementById(`prob-${comp}-dot`);
                const statusElement = document.getElementById(`prob-${comp}-status`);
                
                if (!item || !probabilities) return;
                
                // Get probability for this component
                const probability = probabilities[comp] || 0;
                const pctValue = Math.round(probability * 100);
                
                // Update percentage display
                pctElement.textContent = `${pctValue}%`;
                
                // Update bar width
                barElement.style.width = `${pctValue}%`;
                
                // Check if this component is currently failing
                const isFailing = failedComponents && failedComponents.includes(comp);
                
                // Update visual state
                if (isFailing) {
                    item.classList.add('failing');
                    dotElement.classList.add('failing');
                    statusElement.textContent = '‚ö†Ô∏è FAILING';
                    statusElement.style.color = '#ff6b6b';
                } else {
                    item.classList.remove('failing');
                    dotElement.classList.remove('failing');
                    statusElement.textContent = 'Normal';
                    statusElement.style.color = '#666';
                }
            });
        }

        // Toggle injection
        async function toggleInjection() {
            try {
                const response = await fetch('/toggle_injection', { method: 'POST' });
                const data = await response.json();
                injectionActive = data.inject_anomaly;
                activeFailedComponents = data.failed_components || [];
                updateInjectionUI();
            } catch (error) {
                console.error('Error toggling injection:', error);
            }
        }

        // Update injection UI with component-based failure display
        function updateInjectionUI() {
            const btn = document.getElementById('btn-inject');
            const dot = document.getElementById('dot-injection');
            const label = document.getElementById('label-injection');

            if (injectionActive) {
                btn.className = 'btn btn-warning';
                // Show which components are failing
                const failureText = activeFailedComponents.length > 0 
                    ? activeFailedComponents.map(c => c.toUpperCase()).join(' + ')
                    : 'ACTIVE';
                btn.innerHTML = `üõë STOP: ${failureText} üõë`;
                dot.className = 'status-dot danger';
                label.textContent = `Failing: ${failureText}`;
            } else {
                btn.className = 'btn btn-danger';
                btn.innerHTML = 'üî• INJECT FAILURE üî•';
                dot.className = 'status-dot inactive';
                label.textContent = 'Inject Failure: OFF';
                activeFailedComponents = [];
            }
        }

        // Toggle simulation
        function toggleSimulation() {
            if (isStreaming) {
                stopStream();
            } else {
                startStream();
            }
        }

        // Fetch data
        async function fetchData() {
            try {
                const response = await fetch('/simulate_data');
                const data = await response.json();
                
                // Update injection state from server
                injectionActive = data.inject_active;
                // Update active failed components list from server
                if (data.failed_components) {
                    activeFailedComponents = data.failed_components;
                }
                updateInjectionUI();
                
                // Update all visualizations
                updateSystemStatus(data.is_anomaly, data.reconstruction_error, data.threshold);
                // Pass anomalous_parameters for per-sensor highlighting
                updateSensorReadings(data.sensor_readings, data.is_anomaly, data.anomalous_parameters || []);
                // Use sensor_3d_coords for actual sensor feature visualization
                updatePCAPlot(data.sensor_3d_coords || data.pca_coords, data.is_anomaly);
                updateCharts(data.time_series);
                updateTruckComponents(data.affected_components);
                
                // Update failure probability panel
                updateFailureProbabilities(data.failure_probabilities, data.failed_components);
                
                // Update component navigation status indicators
                updateComponentNavStatus(data.affected_components || {});
                
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Start streaming
        function startStream() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            isStreaming = true;
            simulationInterval = setInterval(fetchData, 400);
            
            const btn = document.getElementById('btn-simulate');
            btn.innerHTML = '‚è∏ Pause Stream';
            
            const dotAuto = document.getElementById('dot-auto');
            const labelAuto = document.getElementById('label-auto');
            dotAuto.className = 'status-dot active';
            labelAuto.textContent = 'Auto Mode: ON';
        }

        // Stop streaming
        function stopStream() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            isStreaming = false;
            
            const btn = document.getElementById('btn-simulate');
            btn.innerHTML = 'üìä Simulate Normal';
            
            const dotAuto = document.getElementById('dot-auto');
            const labelAuto = document.getElementById('label-auto');
            dotAuto.className = 'status-dot inactive';
            labelAuto.textContent = 'Auto Mode: OFF';
        }

        // Update component navigation status indicators
        function updateComponentNavStatus(affectedComponents) {
            const componentMap = {
                'engine': 'nav-status-engine',
                'hydraulic': 'nav-status-hydraulic',
                'hydraulics': 'nav-status-hydraulic',
                'wheels': 'nav-status-wheels',
                'chassis': 'nav-status-chassis'
            };
            
            // Reset all to normal first
            Object.values(componentMap).forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = 'NORMAL';
                    el.classList.remove('anomaly');
                }
            });
            
            // Mark anomalies
            if (affectedComponents) {
                Object.entries(affectedComponents).forEach(([comp, isAffected]) => {
                    const statusId = componentMap[comp.toLowerCase()];
                    const el = document.getElementById(statusId);
                    if (el && isAffected) {
                        el.textContent = '‚ö†Ô∏è ALERT';
                        el.classList.add('anomaly');
                    }
                });
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            initPlots();
            
            // Get initial injection state including any active failures and probabilities
            fetch('/get_injection_state')
                .then(r => r.json())
                .then(data => {
                    injectionActive = data.inject_anomaly;
                    activeFailedComponents = data.failed_components || [];
                    updateInjectionUI();
                    // Update probability panel with initial data
                    if (data.failure_probabilities) {
                        updateFailureProbabilities(data.failure_probabilities, data.failed_components);
                    }
                });
            
            // Also fetch probability data separately to ensure it's displayed
            fetch('/get_failure_probabilities')
                .then(r => r.json())
                .then(data => {
                    if (data.probabilities) {
                        updateFailureProbabilities(data.probabilities, activeFailedComponents);
                    }
                });
        });
    </script>
</body>
</html>
